{% extends "base.html" %}

{% block titulo %}üßçVISITANTES {% endblock %} 

{% block contenido %}

        {% load static %}

                        <!-- Filtros avanzados -->
                        <div class="card mb-4">
                        <div class="card-body">
                            <form method="get" id="filtro-form" class="d-flex flex-wrap gap-2 align-items-center justify-content-end">

                            <!-- B√∫squeda general -->
                            <input type="text" name="q" class="form-control form-control-sm" placeholder="Buscar..." value="{{ query }}" style="max-width: 200px;">

                            <!-- Selector de campo -->
                            <select id="campo-select" class="form-select form-select-sm" style="max-width: 160px;">
                                <option selected disabled>Filtrar por campo</option>
                                <option value="autoriza">Autoriza</option>
                                <option value="telefono">Tel√©fono</option>
                                <option value="empresa">Empresa</option>
                            </select>

                            <!-- Input para valor -->
                            <input type="text" id="campo-valor" class="form-control form-control-sm" placeholder="Valor..." style="max-width: 160px;">

                            <!-- Bot√≥n para agregar filtro -->
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="agregarFiltro()">Agregar filtro</button>

                            <!-- Filtro por fecha -->
                            <div class="d-flex align-items-center gap-2 mt-2">
                                <label class="form-label mb-0">Desde:</label>
                                <input type="date" name="desde" class="form-control form-control-sm" value="{{ desde }}" style="max-width: 150px;">
                                
                                <label class="form-label mb-0">Hasta:</label>
                                <input type="date" name="hasta" class="form-control form-control-sm" value="{{ hasta }}" style="max-width: 150px;">
                            </div>

                            <!-- Etiquetas de filtros activos -->
                            <div id="filtros-activos" class="d-flex flex-wrap gap-2 mt-3"></div>

                            <!-- Bot√≥n de b√∫squeda -->
                            <button type="submit" class="btn btn-sm btn-primary mt-2">Filtrar</button>
                            </form>
                        </div>
                        </div>

        {% load static %}
<script src="{% static 'js/filtros.js' %}"></script>

<!--================================================================================================================-->

 <div class="col-md-11">   
  <table class="table">
        <thead>
            <tr>
                <th>T.ID</th>
                <th>N¬∞ ID</th>
                <th>NOMBRE</th>
                <th>APELLIDO</th>
                <th>TELEFONO</th>
                <th>EMPRESA</th>
                <th>AUTORIZA</th>
                <th>SALIDA NOC</th>
                <th>MOTIVO</th>
                <th></th>
                <th>SALIDA</th>
                <th>ACCIONES</th>          
            </tr>
        </thead>
            <tbody>
            {% for visitante in visitantes %}
                <tr>
                    <td>{{ visitante.tipoidentificacion }}</td>
                    <td>{{ visitante.identificacion }}</td>
                    <td>{{ visitante.nombre }}</td>
                    <td>{{ visitante.apellido }}</td>
                    <td>{{ visitante.telefono }}</td>
                    <td>{{ visitante.empresa }}</td>
                    <td>{{ visitante.autoriza }}</td>
                    <td>
                        {% if visitante.horadesalidanoc %}
                        ‚òëÔ∏è {{ visitante.horadesalidanoc|date:"d/m/Y H:i" }}
                        {% else %}
                        ‚ùå <!--Sin Registro-->
                        {% endif %}
                    </td>
                    <td>{{ visitante.motivovisita|default:"‚Äî" }}</td>
                    <td>
                        <form method="POST" action="{% url 'boton_salida' %}">
                            {% csrf_token %}
                            <input type="hidden" name="visitante_id" value="{{ visitante.id }}">
                            {% if visitante.fecha_salida %}
                                <button type="submit" class="btn btn-sm btn-success" disabled>‚òëÔ∏è</button>
                            {% else %}
                                <button type="submit" class="btn btn-sm btn-primary">‚òëÔ∏è</button>
                            {% endif %}                  
                        </form>
                    
                    <td>
                        {% if visitante.fecha_salida %}
                            {{ visitante.fecha_salida|date:"d/m/Y H:i" }}
                        {% else %}
                            ‚è≥ SIN REGISTRO
                        {% endif %}
                    </td>
                    
                    <td>
                        <button type="button"  
                                class="btn-primary"
                                id="boton_modificar{{ visitante.id }}" 
                                data-bs-toggle="modal"
                                data-bs-target="#modal_modificar"
                                data-id="{{ visitante.id }}">
                                MODIFICAR
                        </button> 
        
                    </td>
                </tr>


                    <!--MODAL PARA MODIFICAR DATOS DEL USUARIO-->
                        <form method="POST" action="">
                            {% csrf_token %}
                            <div class="modal fade" id="modal_modificar" tabindex="-1" aria-labelledby="modalmodificarlabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">

                                            <div class="modal-header text-center">
                                                <h5 class="modal-title w-100" id="modalmodificarlabel">MODIFIQUE DATOS CLIENTES</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cerrar"></button>
                                            </div>
                                        
                                            <div class="modal-body">
                                                <h6 class="card-title">NUMERO DE IDENTIFICACION</h6>
                                                    <input type="number" class="form-control" name="txtidentificacion" placeholder="{{ visitante.identificacion }}">
                                                <h6 class="card-title">NOMBRE</h6>
                                                    <input type="text" class="form-control" name="txtnombre" placeholder="{{ visitante.nombre }}">
                                                <h6 class="card-title">APELLIDO</h6>
                                                    <input type="text" class="form-control" name="txtapellido" placeholder="{{ visitante.apellido }}">  
                                                <h6 class="card-title">TELEFONO</h6>
                                                    <input type="tel" class="form-control" name="txttelefono" placeholder="{{ visitante.telefono }}">

                                                <input type="hidden" name="modificar" id="modificarinput">
                                                <input type="hidden" name="visitante_id" id="modificarinputID" value="{{ visitante.identificacion }}">
                                            </div>
                                            
                                                
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‚ùå SALIR</button>     
                                                <button type="submit" class="btn btn-success"  onclick="return guardarfirma()">‚úÖ MODIFICAR</button>
                                            </div>
                                    </div>
                                </div>
                            </div>
                        </form>   
                

            {% endfor %}
                    
            </tbody>

    </table>

        <div class="paginacion">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}">Anterior</a>
            {% endif %}

            <span>P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">Siguiente</a>
            {% endif %}
        </div>


</div>

{% endblock %}
